{"version":3,"file":"board.min.js","sources":["../src/board.js"],"sourcesContent":["import {BaseComponent, DragDrop} from 'core/reactive';\nimport selectors from 'mod_kanban/selectors';\nimport exporter from 'mod_kanban/exporter';\n/**\n * Component representing a kanban board.\n */\nexport default class extends BaseComponent {\n    LOCKED_COLUMNS = 1;\n    LOCKED_COMPLETE = 2;\n\n    static init(target) {\n        let element = document.getElementById(target);\n        return new this({\n            element: element,\n        });\n    }\n\n    create() {\n        this.cmid = this.element.dataset.cmid;\n        this.id = this.element.dataset.id;\n    }\n\n    getWatchers() {\n        return [\n            {watch: `board:updated`, handler: this._boardUpdated},\n            {watch: `columns:created`, handler: this._createColumn},\n        ];\n    }\n\n    async stateReady() {\n        this.addEventListener(\n            this.getElement(selectors.ADDCOLUMNFIRST),\n            'click',\n            this._addColumn\n        );\n        this.addEventListener(\n            this.getElement(selectors.LOCKBOARDCOLUMNS),\n            'click',\n            this._lockColumns\n        );\n        this.addEventListener(\n            this.getElement(selectors.UNLOCKBOARDCOLUMNS),\n            'click',\n            this._unlockColumns\n        );\n        this.dragdrop = new DragDrop(this);\n        this._continuousUpdate();\n    }\n\n    _continuousUpdate() {\n        setTimeout(() => {\n            this.reactive.dispatch('getUpdates');\n            this._continuousUpdate();\n        }, 10000);\n    }\n\n    /**\n     * Remove all subcomponents dependencies.\n     */\n    destroy() {\n        if (this.dragdrop !== undefined) {\n            this.dragdrop.unregister();\n        }\n    }\n\n    _boardUpdated({element}) {\n        const el = this.getElement();\n        const colcontainer = this.getElement(selectors.COLUMNCONTAINER);\n        if (element.sequence !== undefined) {\n            let sequence = element.sequence.split(',');\n            [...colcontainer.children]\n            .forEach((node) => {\n                if (node.classList.contains('mod_kanban_column') && !sequence.includes(node.dataset.id)) {\n                    colcontainer.removeChild(node);\n                }\n            });\n            [...colcontainer.children]\n            .sort((a, b)=>sequence.indexOf(a.dataset.id) > sequence.indexOf(b.dataset.id) ? 1 : -1)\n            .forEach(node=>colcontainer.appendChild(node));\n        }\n        if (element.locked !== undefined) {\n            if (element.locked != 0) {\n                el.classList.add('mod_kanban_board_locked_columns');\n            } else {\n                el.classList.remove('mod_kanban_board_locked_columns');\n            }\n        }\n    }\n\n    async _createColumn({element}) {\n        let data = Object.assign({\n            id: element.id,\n            title: element.title,\n            options: element.options,\n            sequence: element.sequence,\n        }, exporter.exportCapabilities(this.reactive.state));\n        let placeholder = document.createElement('li');\n        placeholder.setAttribute('data-id', data.id);\n        this.getElement().appendChild(placeholder);\n        const newcomponent = await this.renderComponent(placeholder, 'mod_kanban/column', data);\n        const newelement = newcomponent.getElement();\n        this.getElement().replaceChild(newelement, placeholder);\n    }\n\n    _addColumn() {\n        this.reactive.dispatch('addColumn', 0);\n    }\n\n    _lockColumns() {\n        this.reactive.dispatch('lockColumns');\n    }\n\n    _unlockColumns() {\n        this.reactive.dispatch('unlockColumns');\n    }\n\n    /**\n     * Validate draggable data.\n     * @param {object} dropdata\n     * @returns {boolean} if the data is valid for this drop-zone.\n     */\n    validateDropData(dropdata) {\n        let type = dropdata?.type;\n        return type == 'column';\n    }\n\n    /**\n     * Executed when a valid dropdata is dropped over the drop-zone.\n     * @param {object} dropdata\n     */\n    drop(dropdata) {\n        this.reactive.dispatch('moveColumn', dropdata.id, 0);\n    }\n\n    /**\n     * Optional method to show some visual hints to the user.\n     */\n    showDropZone() {\n        this.getElement(selectors.ADDCOLUMNCONTAINER).classList.add('mod_kanban_insert');\n    }\n\n    /**\n     * Optional method to remove visual hints to the user.\n     */\n    hideDropZone() {\n        this.getElement(selectors.ADDCOLUMNCONTAINER).classList.remove('mod_kanban_insert');\n    }\n}"],"names":["BaseComponent","target","this","element","document","getElementById","create","cmid","dataset","id","getWatchers","watch","handler","_boardUpdated","_createColumn","addEventListener","getElement","selectors","ADDCOLUMNFIRST","_addColumn","LOCKBOARDCOLUMNS","_lockColumns","UNLOCKBOARDCOLUMNS","_unlockColumns","dragdrop","DragDrop","_continuousUpdate","setTimeout","reactive","dispatch","destroy","undefined","unregister","el","colcontainer","COLUMNCONTAINER","sequence","split","children","forEach","node","classList","contains","includes","removeChild","sort","a","b","indexOf","appendChild","locked","add","remove","data","Object","assign","title","options","exporter","exportCapabilities","state","placeholder","createElement","setAttribute","newelement","renderComponent","replaceChild","validateDropData","dropdata","type","drop","showDropZone","ADDCOLUMNCONTAINER","hideDropZone"],"mappings":"6kBAM6BA,gGACR,0CACC,eAENC,eAED,IAAIC,KAAK,CACZC,QAFUC,SAASC,eAAeJ,UAM1CK,cACSC,KAAOL,KAAKC,QAAQK,QAAQD,UAC5BE,GAAKP,KAAKC,QAAQK,QAAQC,GAGnCC,oBACW,CACH,CAACC,sBAAwBC,QAASV,KAAKW,eACvC,CAACF,wBAA0BC,QAASV,KAAKY,wCAKxCC,iBACDb,KAAKc,WAAWC,mBAAUC,gBAC1B,QACAhB,KAAKiB,iBAEJJ,iBACDb,KAAKc,WAAWC,mBAAUG,kBAC1B,QACAlB,KAAKmB,mBAEJN,iBACDb,KAAKc,WAAWC,mBAAUK,oBAC1B,QACApB,KAAKqB,qBAEJC,SAAW,IAAIC,mBAASvB,WACxBwB,oBAGTA,oBACIC,YAAW,UACFC,SAASC,SAAS,mBAClBH,sBACN,KAMPI,eAC0BC,IAAlB7B,KAAKsB,eACAA,SAASQ,aAItBnB,wBAAcV,QAACA,oBACL8B,GAAK/B,KAAKc,aACVkB,aAAehC,KAAKc,WAAWC,mBAAUkB,yBACtBJ,IAArB5B,QAAQiC,SAAwB,KAC5BA,SAAWjC,QAAQiC,SAASC,MAAM,SAClCH,aAAaI,UAChBC,SAASC,OACFA,KAAKC,UAAUC,SAAS,uBAAyBN,SAASO,SAASH,KAAKhC,QAAQC,KAChFyB,aAAaU,YAAYJ,aAG7BN,aAAaI,UAChBO,MAAK,CAACC,EAAGC,IAAIX,SAASY,QAAQF,EAAEtC,QAAQC,IAAM2B,SAASY,QAAQD,EAAEvC,QAAQC,IAAM,GAAK,IACpF8B,SAAQC,MAAMN,aAAae,YAAYT,aAErBT,IAAnB5B,QAAQ+C,SACc,GAAlB/C,QAAQ+C,OACRjB,GAAGQ,UAAUU,IAAI,mCAEjBlB,GAAGQ,UAAUW,OAAO,mEAKZjD,QAACA,eACbkD,KAAOC,OAAOC,OAAO,CACrB9C,GAAIN,QAAQM,GACZ+C,MAAOrD,QAAQqD,MACfC,QAAStD,QAAQsD,QACjBrB,SAAUjC,QAAQiC,UACnBsB,kBAASC,mBAAmBzD,KAAK0B,SAASgC,QACzCC,YAAczD,SAAS0D,cAAc,MACzCD,YAAYE,aAAa,UAAWV,KAAK5C,SACpCO,aAAaiC,YAAYY,mBAExBG,kBADqB9D,KAAK+D,gBAAgBJ,YAAa,oBAAqBR,OAClDrC,kBAC3BA,aAAakD,aAAaF,WAAYH,aAG/C1C,kBACSS,SAASC,SAAS,YAAa,GAGxCR,oBACSO,SAASC,SAAS,eAG3BN,sBACSK,SAASC,SAAS,iBAQ3BsC,iBAAiBC,gBAEE,WADJA,MAAAA,gBAAAA,SAAUC,MAQzBC,KAAKF,eACIxC,SAASC,SAAS,aAAcuC,SAAS3D,GAAI,GAMtD8D,oBACSvD,WAAWC,mBAAUuD,oBAAoB/B,UAAUU,IAAI,qBAMhEsB,oBACSzD,WAAWC,mBAAUuD,oBAAoB/B,UAAUW,OAAO"}