{"version":3,"file":"card.min.js","sources":["../src/card.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  Component representing a card in a kanban board.\n *\n * @module     mod_kanban/card\n * @copyright  2026 ISB Bayern\n * @author     Stefan Hanauska <stefan.hanauska@csg-in.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport {DragDrop} from 'core/reactive';\nimport selectors from 'mod_kanban/selectors';\nimport exporter from 'mod_kanban/exporter';\nimport {exception as displayException, saveCancel} from 'core/notification';\nimport ModalForm from 'core_form/modalform';\nimport Modal from 'core/modal';\nimport * as Str from 'core/str';\nimport {get_string as getString} from 'core/str';\nimport Templates from 'core/templates';\nimport KanbanComponent from 'mod_kanban/kanbancomponent';\nimport Log from 'core/log';\nimport KanbanNotification from 'mod_kanban/notification';\n\n/**\n * Component representing a card in a kanban board.\n */\nexport default class extends KanbanComponent {\n    /**\n     * For relative time helper.\n     */\n    _units = {\n        year: 24 * 60 * 60 * 1000 * 365,\n        month: 24 * 60 * 60 * 1000 * 365 / 12,\n        day: 24 * 60 * 60 * 1000,\n        hour: 60 * 60 * 1000,\n        minute: 60 * 1000,\n        second: 1000\n    };\n\n    /**\n     * Function to initialize component, called by mustache template.\n     * @param {*} target The id of the HTMLElement to attach to\n     * @returns {BaseComponent} New component attached to the HTMLElement represented by target\n     */\n    static init(target) {\n        let element = document.getElementById(target);\n        return new this({\n            element: element,\n        });\n    }\n\n    /**\n     * Called after the component was created.\n     */\n    create() {\n        this.id = this.element.dataset.id;\n    }\n\n    /**\n     * Watchers for this component.\n     * @returns {array} All watchers for this component\n     */\n    getWatchers() {\n        return [\n            {watch: `cards[${this.id}]:updated`, handler: this._cardUpdated},\n            {watch: `cards[${this.id}]:deleted`, handler: this._cardDeleted},\n            {watch: `filters:updated`, handler: this._applyFilters},\n            {watch: `filters:deleted`, handler: this._applyFilters},\n            {watch: `discussions:created`, handler: this._discussionUpdated},\n            {watch: `discussions:updated`, handler: this._discussionUpdated},\n            {watch: `discussions:deleted`, handler: this._discussionUpdated},\n            {watch: `history:created`, handler: this._historyUpdated},\n            {watch: `history:updated`, handler: this._historyUpdated},\n            {watch: `history:deleted`, handler: this._historyUpdated},\n        ];\n    }\n\n    /**\n     * Called once when state is ready (also if component is registered after initial state was set), attaching event\n     * listeners and initializing drag and drop.\n     * @param {*} state The initial state\n     */\n    stateReady(state) {\n        // Get language for relative time formatting.\n        let lang = 'en';\n        if (state.common.lang !== undefined) {\n            lang = state.common.lang;\n        }\n        // The property state.common.lang contains the locale extracted from the currently used moodle language pack.\n        // This should be a real locale and thus suitable for RelativeTimeFormat, for edge cases however we are\n        // using a fallback locale here.\n        try {\n            this.rtf = new Intl.RelativeTimeFormat(lang, {numeric: 'auto'});\n        } catch (e) {\n            // Fallback if there is no valid lang found.\n            this.rtf = new Intl.RelativeTimeFormat('en', {numeric: 'auto'});\n        }\n\n        this.addEventListener(\n            this.getElement(selectors.DELETECARD, this.id),\n            'click',\n            this._removeConfirm\n        );\n        this.addEventListener(\n            this.getElement(selectors.ADDCARD, this.id),\n            'click',\n            this._addCard\n        );\n        this.addEventListener(\n            this.getElement(selectors.COMPLETE, this.id),\n            'click',\n            this._completeCard\n        );\n        this.addEventListener(\n            this.getElement(selectors.UNCOMPLETE, this.id),\n            'click',\n            this._uncompleteCard\n        );\n        this.addEventListener(\n            this.getElement(selectors.ASSIGNSELF, this.id),\n            'click',\n            this._assignSelf\n        );\n        this.addEventListener(\n            this.getElement(selectors.UNASSIGNSELF, this.id),\n            'click',\n            this._unassignSelf\n        );\n        this.addEventListener(\n            this.getElement(selectors.EDITDETAILS, this.id),\n            'click',\n            this._editDetails\n        );\n        this.addEventListener(\n            this.getElement(selectors.DISCUSSIONMODALTRIGGER),\n            'click',\n            this._showDiscussionModal\n        );\n        this.addEventListener(\n            this.getElement(selectors.DISCUSSIONSHOW, this.id),\n            'click',\n            this._showDiscussionModal\n        );\n        this.addEventListener(\n            this.getElement(selectors.HISTORYMODALTRIGGER),\n            'click',\n            this._showHistoryModal\n        );\n        this.addEventListener(\n            this.getElement(selectors.MOVEMODALTRIGGER),\n            'click',\n            this._showMoveModal\n        );\n        this.addEventListener(\n            this.getElement(selectors.PUSHCARD),\n            'click',\n            this._pushCardConfirm\n        );\n        this.addEventListener(\n            this.getElement(selectors.DUPLICATE),\n            'click',\n            this._duplicateCard\n        );\n        this.addEventListener(\n            this.getElement(selectors.DETAILBUTTON),\n            'click',\n            this._showDetailsModal\n        );\n        this.addEventListener(\n            this.getElement(selectors.COPYCARDLINK),\n            'click',\n            this._copyCardLink\n        );\n\n        this.draggable = false;\n        this.dragdrop = new DragDrop(this);\n        this.checkEditing(state);\n        this.boardid = state.board.id;\n        this.cmid = state.common.id;\n        this.userid = state.board.userid;\n        this.groupid = state.board.groupid;\n        this._dueDateFormat();\n        if (state.cards.get(this.id).highlighted) {\n            this._highlightCard();\n        }\n    }\n\n    /**\n     * Show modal to move a column.\n     */\n    _showMoveModal() {\n        let data = exporter.exportStateForTemplate(this.reactive.state);\n        data.cardid = this.id;\n        data.kanbancolumn = this.reactive.state.cards.get(this.id).kanban_column;\n        Str.get_strings([\n            {key: 'movecard', component: 'mod_kanban'},\n            {key: 'move', component: 'core'},\n        ]).then((strings) => {\n            return saveCancel(\n                strings[0],\n                Templates.render('mod_kanban/movemodal', data),\n                strings[1],\n                () => {\n                    let column = document.querySelector(selectors.MOVECARDCOLUMN + `[data-id=\"${this.id}\"]`).value;\n                    let aftercard = document.querySelector(selectors.MOVECARDAFTERCARD + `[data-id=\"${this.id}\"]`).value;\n                    this.reactive.dispatch('moveCard', this.id, column, aftercard);\n                }\n            );\n        }).catch((error) => Log.debug(error));\n    }\n\n    /**\n     * Show modal with card details.\n     * @param {*} event Click event.\n     */\n    async _showDetailsModal(event) {\n        let id = this.id;\n        if (event.target.dataset.id !== undefined) {\n            id = event.target.dataset.id;\n        }\n\n        let data = exporter.exportCard(this.reactive.state, id);\n        let title = this.reactive.state.common.usenumbers ? '#' + data.number + ' ' + data.title : data.title;\n\n        let body = await Templates.renderForPromise('mod_kanban/descriptionmodal', data);\n\n        const modal = await Modal.create({\n            body: body.html,\n            bodyJS: body.js,\n            title: title,\n            removeOnClose: true,\n            show: true,\n        });\n        modal.modal[0].dataset.id = id;\n    }\n\n    /**\n     * Simulate click on details button.\n     * @param {*} event Click event.\n     */\n    _clickDetailsButton(event) {\n        const card = document.querySelector(\n            selectors.CARD + `[data-number=\"${event.target.dataset.id}\"]` + ' ' + selectors.DETAILBUTTON\n        );\n        if (card) {\n            card.click();\n        }\n    }\n\n    /**\n     * Display confirmation modal for pushing a card.\n     * @param {*} event\n     */\n    _pushCardConfirm(event) {\n        Str.get_strings([\n            {key: 'pushcard', component: 'mod_kanban'},\n            {key: 'pushcardconfirm', component: 'mod_kanban'},\n            {key: 'copy', component: 'core'},\n        ]).then((strings) => {\n            return saveCancel(\n                strings[0],\n                strings[1],\n                strings[2],\n                () => {\n                    this._pushCard(event);\n                }\n            );\n        }).catch((error) => Log.debug(error));\n    }\n\n    /**\n     * Display confirmation modal for deleting a card.\n     * @param {*} event\n     */\n    _removeConfirm(event) {\n        Str.get_strings([\n            {key: 'deletecard', component: 'mod_kanban'},\n            {key: 'deletecardconfirm', component: 'mod_kanban'},\n            {key: 'delete', component: 'core'},\n        ]).then((strings) => {\n            return saveCancel(\n                strings[0],\n                strings[1],\n                strings[2],\n                () => {\n                    this._removeCard(event);\n                }\n            );\n        }).catch((error) => Log.debug(error));\n    }\n\n    /**\n     * Show the discussion modal.\n     * @param {*} event Click event.\n     */\n    async _showDiscussionModal(event) {\n        let id = this.id;\n        if (event.target.dataset.id !== undefined) {\n            id = event.target.dataset.id;\n        }\n\n        let data = exporter.exportCard(this.reactive.state, id);\n        let title = this.reactive.state.common.usenumbers ? '#' + data.number + ' ' + data.title : data.title;\n\n        let body = await Templates.renderForPromise('mod_kanban/discussionmodalbody', data);\n        let footer = await Templates.renderForPromise('mod_kanban/discussionmodalfooter', data);\n\n        const modal = await Modal.create({\n            body: body.html,\n            title: title,\n            footer: footer.html,\n            removeOnClose: true,\n        });\n        modal.modal[0].dataset.id = id;\n        modal.modal[0].classList.add('mod_kanban_discussion_modal');\n        modal.modal[0].classList.add('mod_kanban_loading');\n        modal.modal[0].addEventListener('click', (event) => {\n            if (event.target.closest(selectors.DISCUSSIONSEND)) {\n                this._sendMessage(event);\n            }\n            if (event.target.closest(selectors.DELETEMESSAGE)) {\n                this._removeMessageConfirm(event);\n            }\n            if (event.target.closest(selectors.CARDNUMBER)) {\n                this._clickDetailsButton(event);\n            }\n        });\n        modal.show();\n        this._renderDiscussionMessages();\n        this.reactive.dispatch('getDiscussionUpdates', this.id);\n    }\n\n    /**\n     * Display confirmation modal for deleting a discussion message.\n     * @param {*} event\n     */\n    _removeMessageConfirm(event) {\n        Str.get_strings([\n            {key: 'deletemessage', component: 'mod_kanban'},\n            {key: 'deletemessageconfirm', component: 'mod_kanban'},\n            {key: 'delete', component: 'core'},\n        ]).then((strings) => {\n            return saveCancel(\n                strings[0],\n                strings[1],\n                strings[2],\n                () => {\n                    this._removeMessage(event);\n                }\n            );\n        }).catch((error) => Log.debug(error));\n    }\n\n    /**\n     * Dispatch event to add a message to discussion.\n     * @param {*} event\n     */\n    _sendMessage(event) {\n        let el = event.target.closest(selectors.DISCUSSIONMODAL).querySelector(selectors.DISCUSSIONINPUT);\n        let message = el.value.trim();\n        if (message != '') {\n            this.reactive.dispatch('sendDiscussionMessage', this.id, message);\n            el.value = '';\n        }\n    }\n\n    /**\n     * Called when discussion was updated.\n     * @param {*} event\n     */\n    async _discussionUpdated(event) {\n        if (event.element.kanban_card != this.id) {\n            return;\n        }\n        this._renderDiscussionMessages();\n    }\n\n    /**\n     * Render the discussion messages in the discussion modal.\n     */\n    _renderDiscussionMessages() {\n        let modal = document.querySelector(selectors.DISCUSSIONMODAL + `[data-id=\"${this.id}\"]`);\n        if (modal) {\n            let data = {\n                discussions: exporter.exportDiscussion(this.reactive.state, this.id)\n            };\n            Templates.renderForPromise('mod_kanban/discussionmessages', data).then(({html}) => {\n                modal.classList.remove('mod_kanban_loading');\n                modal.querySelector(selectors.DISCUSSION).innerHTML = html;\n                let el = modal.querySelector('.modal-body');\n                // Scroll down to latest message.\n                el.scrollTop = el.scrollHeight;\n                return true;\n            }).catch((error) => displayException(error));\n        }\n    }\n\n    /**\n     * Show the history modal for the card.\n     * @param {*} event\n     */\n    async _showHistoryModal(event) {\n        let id = this.id;\n        if (event.target.dataset.id !== undefined) {\n            id = event.target.dataset.id;\n        }\n\n        let data = exporter.exportCard(this.reactive.state, id);\n        let title = getString(\n            'historyfor',\n            'mod_kanban',\n            this.reactive.state.common.usenumbers ? '#' + data.number + ' ' + data.title : data.title\n        );\n\n        let body = await Templates.renderForPromise('mod_kanban/historymodalbody', data);\n\n        const modal = await Modal.create({\n            body: body.html,\n            title: title,\n            removeOnClose: true,\n            show: true,\n        });\n        modal.modal[0].dataset.id = id;\n        modal.modal[0].classList.add('mod_kanban_history_modal');\n        modal.modal[0].classList.add('mod_kanban_loading');\n        this._renderHistoryItems();\n        this.reactive.dispatch('getHistoryUpdates', this.id);\n    }\n\n    /**\n     * Called when history was updated.\n     * @param {*} event\n     */\n    async _historyUpdated(event) {\n        if (event.element.kanban_card != this.id) {\n            return;\n        }\n        this._renderHistoryItems();\n    }\n\n    /**\n     * Render the history items in the history modal.\n     */\n    _renderHistoryItems() {\n        let modal = document.querySelector(selectors.HISTORYMODAL + `[data-id=\"${this.id}\"]`);\n        let data = {\n            historyitems: exporter.exportHistory(this.reactive.state, this.id)\n        };\n        Templates.renderForPromise('mod_kanban/historyitems', data).then(({html}) => {\n            modal.classList.remove('mod_kanban_loading');\n            modal.querySelector(selectors.HISTORY, this.id).innerHTML = html;\n            modal.classList.remove('mod_kanban_loading');\n            // Scroll down to latest history item.\n            let el = modal.querySelector('.modal-body');\n            el.scrollTop = el.scrollHeight;\n            return true;\n        }).catch((error) => displayException(error));\n    }\n\n    /**\n     * Dispatch event to assign the current user to the card.\n     * @param {*} event\n     */\n    _assignSelf(event) {\n        let target = event.target.closest(selectors.ASSIGNSELF);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('assignUser', data.id);\n    }\n\n    /**\n     * Dispatch event to add a card after this card.\n     * @param {*} event\n     */\n    _addCard(event) {\n        document.activeElement.blur();\n        let target = event.target.closest(selectors.ADDCARD);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('addCard', data.columnid, data.id);\n    }\n\n    /**\n     * Highlight this card.\n     */\n    _highlightCard() {\n        this.getElement().scrollIntoView({behavior: 'smooth', block: 'center'});\n        this.getElement().classList.add('mod_kanban_highlighted_card');\n        this.getElement().focus();\n        setTimeout(() => {\n            this.getElement().classList.remove('mod_kanban_highlighted_card');\n        }, 10000);\n    }\n\n    /**\n     * Called when card is updated.\n     * @param {*} param0\n     */\n    async _cardUpdated({element}) {\n        const card = this.getElement();\n        // Card was moved to another column. Move the element to new card (right position is handled by column component).\n        if (card.dataset.columnid != element.kanban_column) {\n            const col = document.querySelector(selectors.COLUMNINNER + '[data-id=\"' + element.kanban_column + '\"]');\n            col.appendChild(card);\n            this.getElement(selectors.ADDCARD, this.id).setAttribute('data-columnid', element.kanban_column);\n            card.setAttribute('data-columnid', element.kanban_column);\n        }\n        const assignees = this.getElement(selectors.ASSIGNEES, this.id);\n        const assignedUsers = this.getElements(selectors.ASSIGNEDUSER, this.id);\n        const userids = [...assignedUsers].map(v => {\n            return v.dataset.userid;\n        });\n        // Update assignees.\n        if (element.assignees !== undefined) {\n            const additional = element.assignees.filter(x => !userids.includes(x));\n            // Remove all elements that represent users that are no longer assigned to this card.\n            if (assignedUsers !== null) {\n                assignedUsers.forEach(assignedUser => {\n                    if (!element.assignees.includes(assignedUser.dataset.userid)) {\n                        assignedUser.parentNode.removeChild(assignedUser);\n                    }\n                });\n            }\n            this.toggleClass(element.assignees.length == 0, 'mod_kanban_unassigned');\n            // Add new assignees.\n            if (element.assignees.length > 0) {\n                additional.forEach(async user => {\n                    let userdata = this.reactive.state.users.get(user);\n                    let data = Object.assign({cardid: element.id}, userdata);\n                    data = Object.assign(data, exporter.exportCapabilities(this.reactive.state));\n                    Templates.renderForPromise('mod_kanban/user', data).then(({html, js}) => {\n                        Templates.appendNodeContents(assignees, html, js);\n                        return true;\n                    }).catch((error) => displayException(error));\n                });\n            }\n        }\n        this.toggleClass(element.selfassigned, 'mod_kanban_selfassigned');\n        // Set card completion state.\n        this.toggleClass(element.completed == 1, 'mod_kanban_closed');\n        // Update title (also in modals).\n        if (element.title !== undefined) {\n            // For Moodle inplace editing title is once needed plain and once with html entities encoded.\n            // This avoids double encoding of html entities as the value of \"data-value\" is exactly what is shown\n            // in the input field when clicking on the inplace editable.\n            let doc = new DOMParser().parseFromString(element.title, 'text/html');\n            const inplaceeditable = this.getElement(selectors.INPLACEEDITABLE);\n            inplaceeditable.setAttribute('data-value', doc.documentElement.textContent);\n            const inplaceeditableLink = inplaceeditable.querySelector('a');\n            if (inplaceeditableLink) {\n                inplaceeditableLink.innerHTML = element.title;\n            }\n        }\n        this.toggleClass(element.hasdescription, 'mod_kanban_hasdescription');\n        this.toggleClass(element.hasattachment, 'mod_kanban_hasattachment');\n        // Update due date.\n        if (element.duedate !== undefined) {\n            this.getElement(selectors.DUEDATE).setAttribute('data-date', element.duedate);\n            this._dueDateFormat();\n        }\n        this.toggleClass(element.discussion, 'mod_kanban_hasdiscussion');\n        // Only option for now is background color.\n        if (element.options !== undefined) {\n            let options = JSON.parse(element.options);\n            if (options.background === undefined) {\n                this.getElement().removeAttribute('style');\n            } else {\n                this.getElement().setAttribute('style', 'background-color: ' + options.background);\n            }\n        }\n        // Enable/disable dragging and inplace editing (e.g. if user is not assigned to the card anymore).\n        this.checkEditing();\n        if (element.highlighted) {\n            this._highlightCard();\n        }\n        this._applyFilters();\n    }\n\n    /**\n     * Delete this card.\n     */\n    _cardDeleted() {\n        this.destroy();\n    }\n\n    /**\n     * Dispatch event to remove this card.\n     * @param {*} event\n     */\n    _removeCard(event) {\n        let target = event.target.closest(selectors.DELETECARD);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('deleteCard', data.id);\n    }\n\n    /**\n     * Dispatch event to push this card.\n     * @param {*} event\n     */\n    _pushCard(event) {\n        let target = event.target.closest(selectors.PUSHCARD);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('pushCard', data.id);\n    }\n\n    /**\n     * Dispatch event to remove this card.\n     * @param {*} event\n     */\n    _removeMessage(event) {\n        let target = event.target.closest(selectors.DELETEMESSAGE);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('deleteMessage', data.id);\n    }\n\n    /**\n     * Dispatch event to complete this card.\n     * @param {*} event\n     */\n    _completeCard(event) {\n        let target = event.target.closest(selectors.COMPLETE);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('completeCard', data.id);\n    }\n\n    /**\n     * Dispatch event to complete this card.\n     * @param {*} event\n     */\n    _uncompleteCard(event) {\n        let target = event.target.closest(selectors.UNCOMPLETE);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('uncompleteCard', data.id);\n    }\n\n    /**\n     * Remove all subcomponents dependencies.\n     */\n    destroy() {\n        if (this.dragdrop !== undefined) {\n            this.dragdrop.unregister();\n        }\n    }\n\n    /**\n     * Get the draggable data of this component.\n     * @returns {object}\n     */\n    getDraggableData() {\n        return {\n            id: this.id,\n            type: 'card',\n        };\n    }\n\n    /**\n     * Conditionally enable / disable dragging and inplace editing.\n     * @param {*} state\n     */\n    checkEditing(state) {\n        if (state === undefined) {\n            state = this.reactive.stateManager.state;\n        }\n        if (state.cards.get(this.id).canedit) {\n            this.draggable = true;\n            this.dragdrop.setDraggable(true);\n        } else {\n            this.draggable = false;\n            this.dragdrop.setDraggable(false);\n        }\n        if (state.cards.get(this.id).completed != 1 && state.cards.get(this.id).canedit) {\n            this.getElement(selectors.INPLACEEDITABLE).setAttribute('data-inplaceeditable', '1');\n        } else {\n            this.getElement(selectors.INPLACEEDITABLE).removeAttribute('data-inplaceeditable');\n        }\n\n        this.toggleClass(state.cards.get(this.id).canedit, 'mod_kanban_canedit');\n    }\n\n    /**\n     * Validate draggable data.\n     * @param {object} dropdata\n     * @returns {boolean} if the data is valid for this drop-zone.\n     */\n    validateDropData(dropdata) {\n        return dropdata?.type == 'card';\n    }\n\n    /**\n     * Executed when a valid dropdata is dropped over the drop-zone.\n     * @param {object} dropdata\n     */\n    drop(dropdata) {\n        if (dropdata.id != this.id) {\n            let newcolumn = this.getElement(selectors.ADDCARD, this.id).dataset.columnid;\n            let aftercard = this.id;\n            this.reactive.dispatch('moveCard', dropdata.id, newcolumn, aftercard);\n        }\n    }\n\n    /**\n     * Dispatch event to unassign the current user.\n     * @param {*} event\n     */\n    _unassignSelf(event) {\n        let target = event.target.closest(selectors.UNASSIGNSELF);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('unassignUser', data.id);\n    }\n\n    /**\n     * Show modal form to edit card details.\n     * @param {*} event\n     */\n    _editDetails(event) {\n        event.preventDefault();\n\n        const modalForm = new ModalForm({\n            formClass: \"mod_kanban\\\\form\\\\edit_card_form\",\n            args: {\n                id: this.id,\n                boardid: this.boardid,\n                cmid: this.cmid,\n                groupid: this.groupid,\n                userid: this.userid\n            },\n            modalConfig: {title: getString('editcard', 'mod_kanban')},\n            returnFocus: this.getElement(),\n        });\n        this.addEventListener(modalForm, modalForm.events.FORM_SUBMITTED, this._updateCard);\n        modalForm.show();\n    }\n\n    /**\n     * Dispatch an event to update card data from the detail modal.\n     * @param {*} event\n     */\n    _updateCard(event) {\n        this.reactive.dispatch('processUpdates', event.detail);\n    }\n\n    /**\n     * Update relative time.\n     * @param {int} timestamp\n     * @returns {string}\n     */\n    updateRelativeTime(timestamp) {\n        let elapsed = new Date(timestamp) - new Date();\n        for (var u in this._units) {\n            if (Math.abs(elapsed) > this._units[u] || u == 'second') {\n                return this.rtf.format(Math.round(elapsed / this._units[u]), u);\n            }\n        }\n        return '';\n    }\n\n    /**\n     * Format due date using relative time.\n     */\n    _dueDateFormat() {\n        // Convert timestamp to ms.\n        let duedate = this.getElement(selectors.DUEDATE).dataset.date * 1000;\n        if (duedate > 0) {\n            let element = this.getElement(selectors.DUEDATE);\n            element.innerHTML = this.updateRelativeTime(duedate);\n            if (duedate < new Date().getTime()) {\n                element.classList.add('mod_kanban_overdue');\n            } else {\n                element.classList.remove('mod_kanban_overdue');\n            }\n        } else {\n            this.getElement(selectors.DUEDATE).innerHTML = '';\n        }\n    }\n\n    /**\n     * Dispatch event to duplicate this card.\n     * @param {*} event Click event.\n     */\n    _duplicateCard(event) {\n        let target = event.target.closest(selectors.DUPLICATE);\n        let data = Object.assign({}, target.dataset);\n        this.reactive.dispatch('duplicateCard', data.id);\n    }\n\n    /**\n     * Apply current filters to this card, hiding it if it does not match the filter criteria.\n     */\n    _applyFilters() {\n        let matchesFilter = true;\n        Object.keys(this.reactive.stateManager.state.filters).forEach(key => {\n            const filtervalue = this.reactive.stateManager.state.filters[key];\n            const card = this.getElement();\n            const title = card.querySelector('.mod_kanban_card_title');\n            if (key == 'title') {\n                const titletext = title.textContent.trim().toLowerCase();\n                if (!titletext.includes(filtervalue.toLowerCase())) {\n                    matchesFilter = false;\n                }\n            }\n        });\n        if (matchesFilter) {\n            this.getElement().classList.remove('d-none');\n        } else {\n            this.getElement().classList.add('d-none');\n        }\n    }\n\n    /**\n     * Copy card link to clipboard\n     */\n    _copyCardLink() {\n        navigator.clipboard.writeText(M.cfg.wwwroot + '/mod/kanban/view.php?cardid=' + this.id).then(() => {\n            this._showCopySuccess();\n            return true;\n        }).catch((error) => {\n            this._showCopyError(error);\n        });\n    }\n\n    /**\n     * Show success message after copying card link.\n     */\n    _showCopySuccess() {\n        Str.get_string('cardlinkcopied', 'mod_kanban').then((message) => {\n            KanbanNotification.show(message);\n            return true;\n        }).catch((error) => Log.debug(error));\n    }\n\n    /**\n     * Show error message after failing to copy card link.\n     */\n    _showCopyError() {\n        Str.get_string('copycardlinkfailed', 'mod_kanban').then((message) => {\n            KanbanNotification.show(message);\n            return true;\n        }).catch((error) => Log.debug(error));\n    }\n}\n"],"names":["KanbanComponent","year","month","day","hour","minute","second","target","this","element","document","getElementById","create","id","dataset","getWatchers","watch","handler","_cardUpdated","_cardDeleted","_applyFilters","_discussionUpdated","_historyUpdated","stateReady","state","lang","undefined","common","rtf","Intl","RelativeTimeFormat","numeric","e","addEventListener","getElement","selectors","DELETECARD","_removeConfirm","ADDCARD","_addCard","COMPLETE","_completeCard","UNCOMPLETE","_uncompleteCard","ASSIGNSELF","_assignSelf","UNASSIGNSELF","_unassignSelf","EDITDETAILS","_editDetails","DISCUSSIONMODALTRIGGER","_showDiscussionModal","DISCUSSIONSHOW","HISTORYMODALTRIGGER","_showHistoryModal","MOVEMODALTRIGGER","_showMoveModal","PUSHCARD","_pushCardConfirm","DUPLICATE","_duplicateCard","DETAILBUTTON","_showDetailsModal","COPYCARDLINK","_copyCardLink","draggable","dragdrop","DragDrop","checkEditing","boardid","board","cmid","userid","groupid","_dueDateFormat","cards","get","highlighted","_highlightCard","data","exporter","exportStateForTemplate","reactive","cardid","kanbancolumn","kanban_column","Str","get_strings","key","component","then","strings","Templates","render","column","querySelector","MOVECARDCOLUMN","value","aftercard","MOVECARDAFTERCARD","dispatch","catch","error","Log","debug","event","exportCard","title","usenumbers","number","body","renderForPromise","Modal","html","bodyJS","js","removeOnClose","show","modal","_clickDetailsButton","card","CARD","click","_pushCard","_removeCard","footer","classList","add","closest","DISCUSSIONSEND","_sendMessage","DELETEMESSAGE","_removeMessageConfirm","CARDNUMBER","_renderDiscussionMessages","_removeMessage","el","DISCUSSIONMODAL","DISCUSSIONINPUT","message","trim","kanban_card","discussions","exportDiscussion","_ref","remove","DISCUSSION","innerHTML","scrollTop","scrollHeight","_renderHistoryItems","HISTORYMODAL","historyitems","exportHistory","_ref2","HISTORY","Object","assign","activeElement","blur","columnid","scrollIntoView","behavior","block","focus","setTimeout","COLUMNINNER","appendChild","setAttribute","assignees","ASSIGNEES","assignedUsers","getElements","ASSIGNEDUSER","userids","map","v","additional","filter","x","includes","forEach","assignedUser","parentNode","removeChild","toggleClass","length","async","userdata","users","user","exportCapabilities","_ref4","appendNodeContents","selfassigned","completed","doc","DOMParser","parseFromString","inplaceeditable","INPLACEEDITABLE","documentElement","textContent","inplaceeditableLink","hasdescription","hasattachment","duedate","DUEDATE","discussion","options","JSON","parse","background","removeAttribute","destroy","unregister","getDraggableData","type","stateManager","canedit","setDraggable","validateDropData","dropdata","drop","newcolumn","preventDefault","modalForm","ModalForm","formClass","args","modalConfig","returnFocus","events","FORM_SUBMITTED","_updateCard","detail","updateRelativeTime","timestamp","elapsed","Date","u","_units","Math","abs","format","round","date","getTime","matchesFilter","keys","filters","filtervalue","toLowerCase","navigator","clipboard","writeText","M","cfg","wwwroot","_showCopySuccess","_showCopyError","get_string"],"mappings":"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"}