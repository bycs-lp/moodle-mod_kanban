define("mod_kanban/column",["exports","core/reactive","mod_kanban/selectors","mod_kanban/exporter"],(function(_exports,_reactive,_selectors,_exporter){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_selectors=_interopRequireDefault(_selectors),_exporter=_interopRequireDefault(_exporter);class _default extends _reactive.BaseComponent{static init(target){return new this({element:document.getElementById(target)})}create(){this.id=this.element.dataset.id}getWatchers(){return[{watch:"columns[".concat(this.id,"]:updated"),handler:this._columnUpdated},{watch:"columns[".concat(this.id,"]:deleted"),handler:this._columnDeleted},{watch:"cards:created",handler:this._cardCreated}]}stateReady(){this.addEventListener(this.getElement(_selectors.default.DELETECOLUMN,this.id),"click",this._removeColumn),this.addEventListener(this.getElement(_selectors.default.ADDCARDFIRST),"click",this._addCard),this.addEventListener(this.getElement(_selectors.default.ADDCOLUMN,this.id),"click",this._addColumn),this.dragdrop=new _reactive.DragDrop(this)}destroy(){void 0!==this.dragdrop&&this.dragdrop.unregister()}getDraggableData(){return{id:this.id,type:"column"}}validateDropData(dropdata){let type=null==dropdata?void 0:dropdata.type;return"card"==type||"column"==type}drop(dropdata){"card"==dropdata.type&&this.reactive.dispatch("moveCard",dropdata.id,this.id,0),"column"==dropdata.type&&dropdata.id!=this.id&&this.reactive.dispatch("moveColumn",dropdata.id,this.id)}showDropZone(){this.element.classList.add("mod_kanban_dropzone")}hideDropZone(){this.element.classList.remove("mod_kanban_dropzone")}_addColumn(event){let target=event.target.closest(_selectors.default.ADDCOLUMN),data=Object.assign({},target.dataset);this.reactive.dispatch("addColumn",data.id)}async _cardCreated(_ref){let{element:element}=_ref;if(element.kanban_column==this.id){let data=Object.assign({id:element.id,title:element.title,options:element.options,kanban_column:element.kanban_column},_exporter.default.exportCapabilities(this.reactive.state)),placeholder=document.createElement("li");placeholder.setAttribute("data-id",data.id);let node=this.getElement(_selectors.default.COLUMNINNER,this.id);node.appendChild(placeholder);const newelement=(await this.renderComponent(placeholder,"mod_kanban/card",data)).getElement();node.replaceChild(newelement,placeholder)}}_addCard(event){let target=event.target.closest(_selectors.default.ADDCARD),data=Object.assign({},target.dataset);this.reactive.dispatch("addCard",data.columnid,0)}_columnUpdated(_ref2){let{element:element}=_ref2;const el=this.getElement(_selectors.default.COLUMNINNER,this.id);let sequence=element.sequence.split(",");[...el.children].sort(((a,b)=>sequence.indexOf(a.dataset.id)>sequence.indexOf(b.dataset.id)?1:-1)).forEach((node=>el.appendChild(node)))}_columnDeleted(){const el=this.getElement();el.parentNode.removeChild(el),this.destroy()}_removeColumn(event){let target=event.target.closest('[data-action="delete_column"]'),data=Object.assign({},target.dataset);this.reactive.dispatch("deleteColumn",data.id)}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=column.min.js.map